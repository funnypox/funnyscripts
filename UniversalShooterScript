-- Universal ESP Script
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ESPEnabled = true -- Default state for ESP

-- Function to add ESP to a character
local function addHighlight(character)
    if character:FindFirstChild("HumanoidRootPart") then
        if not character:FindFirstChild("Highlight") then
            local highlight = Instance.new("Highlight")
            highlight.Name = "Highlight"
            highlight.Adornee = character
            highlight.Parent = character
            highlight.FillColor = Color3.fromRGB(0, 255, 0) -- Green for ESP
            highlight.FillTransparency = 0.5
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255) -- White outline
            highlight.OutlineTransparency = 0
        end
    end
end

-- Function to toggle ESP
local function toggleESP()
    ESPEnabled = not ESPEnabled

    if ESPEnabled then
        -- Enable ESP for all players
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                addHighlight(player.Character)
            end
        end
    else
        -- Disable ESP
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("Highlight") then
                player.Character.Highlight:Destroy()
            end
        end
    end
end

-- Apply ESP to existing players and handle new players
for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer and player.Character then
        addHighlight(player.Character)
    end

    player.CharacterAdded:Connect(function(character)
        if ESPEnabled then
            addHighlight(character)
        end
    end)
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function(character)
            if ESPEnabled then
                addHighlight(character)
            end
        end)
    end
end)

-- Simple notification for toggling ESP
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ESP Loaded";
    Text = "Press F to toggle ESP.";
    Duration = 5;
})

-- Listen for toggle key press
local UserInputService = game:GetService("UserInputService")
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.F then
        toggleESP()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "ESP Toggled";
            Text = ESPEnabled and "ESP Enabled" or "ESP Disabled";
            Duration = 3;
        })
    end
end)
